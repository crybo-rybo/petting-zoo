set(PETTING_ZOO_WEB_DIST_DIR "${CMAKE_BINARY_DIR}/web-dist")

file(GLOB_RECURSE PETTING_ZOO_WEB_SRC_FILES CONFIGURE_DEPENDS
  "${CMAKE_CURRENT_SOURCE_DIR}/src/*.svelte"
  "${CMAKE_CURRENT_SOURCE_DIR}/src/*.ts"
)
file(GLOB_RECURSE PETTING_ZOO_WEB_PUBLIC_FILES CONFIGURE_DEPENDS
  "${CMAKE_CURRENT_SOURCE_DIR}/public/*"
)
file(GLOB_RECURSE PETTING_ZOO_WEB_FALLBACK_FILES CONFIGURE_DEPENDS
  "${CMAKE_CURRENT_SOURCE_DIR}/fallback-dist/*"
)

set(PETTING_ZOO_WEB_INPUT_FILES
  ${CMAKE_CURRENT_SOURCE_DIR}/package.json
  ${CMAKE_CURRENT_SOURCE_DIR}/package-lock.json
  ${CMAKE_CURRENT_SOURCE_DIR}/tsconfig.json
  ${CMAKE_CURRENT_SOURCE_DIR}/vite.config.ts
  ${CMAKE_CURRENT_SOURCE_DIR}/index.html
  ${PETTING_ZOO_WEB_SRC_FILES}
  ${PETTING_ZOO_WEB_PUBLIC_FILES}
  ${PETTING_ZOO_WEB_FALLBACK_FILES}
)

add_custom_command(
  OUTPUT "${PETTING_ZOO_WEB_DIST_DIR}/index.html"
  COMMAND ${CMAKE_COMMAND}
    -DWEB_DIR=${CMAKE_CURRENT_SOURCE_DIR}
    -DOUT_DIR=${PETTING_ZOO_WEB_DIST_DIR}
    -DFALLBACK_DIR=${CMAKE_CURRENT_SOURCE_DIR}/fallback-dist
    -DPZ_BUILD_WEB=${PETTING_ZOO_BUILD_WEB}
    -DPZ_ALLOW_FALLBACK=${PETTING_ZOO_WEB_ALLOW_FALLBACK}
    -P ${CMAKE_SOURCE_DIR}/cmake/BuildWeb.cmake
  DEPENDS ${PETTING_ZOO_WEB_INPUT_FILES}
  COMMENT "Preparing web assets"
  VERBATIM
)

add_custom_target(petting_zoo_web_assets ALL DEPENDS "${PETTING_ZOO_WEB_DIST_DIR}/index.html")
set(PETTING_ZOO_WEB_DIST_DIR "${PETTING_ZOO_WEB_DIST_DIR}" PARENT_SCOPE)
